<%- include("templates/header") %>

<!-- <img src="images/search.png" alt="Search" id="searchIcon" /> -->

<div id="main-welcome-container">
<form id="main-search-form" class="d-flex mx-auto" role="search">
	<div class="dropdown d-flex justify-content-center">
	</div>
	<button type="button" id="filter-button" class="btn btn-light dropdown-toggle" data-bs-toggle="dropdown"
		aria-expanded="false" data-bs-auto-close="outside">
		<span class="material-symbols-outlined">filter_list</span>
	</button>
	<!-- Search bar text input -->
	<input id="search-text" class="form-control" type="search" placeholder="Search for services" aria-label="Search"
		aria-describedby="search-addon" />
	<!-- Search button -->
	<button id="search-button" class="btn btn-light" type="submit">
		<span class="material-symbols-outlined">search</span>
	</button>
	</form>

	<h2 id="main-welcome-message">Welcome <%= username %>!</h2>

	</div>

	<!-- Services list of cards -->
	<div id="main-content-container">
		<h3 id="services-header">Find services</h3>
		<div id="main-service-list-container" class="row mb-3 text-center">
			<div class="col-md-4 themed-grid-col service-container">service_placeholder</div>
			<div class="col-md-4 themed-grid-col service-container">service_placeholder</div>
			<div class="col-md-4 themed-grid-col service-container">service_placeholder</div>
			
		</div>
	</div>

	<div id="servicesContainer">

		<% for(let i=0; i < services.length; i++) {%>
			<div class="col-md-4 themed-grid-col service-container">
				 <div>Service name: <%= services[i].name %></div>
				<div>Service description: <%= services[i].description%></div>
			</div>
		
			<br>
			<% } %>
	</div>

	<script>
		document.addEventListener('DOMContentLoaded', function () {
			var link = document.createElement('link');
			link.rel = 'stylesheet';
			link.href = '/main.css';
			document.head.appendChild(link);
		});

		document.addEventListener('DOMContentLoaded', function () {
			// Get references to the search input and icon
			const searchInput = document.getElementById('search-text');
			const searchIcon = document.getElementById('search-button');

			// Add event listener to the search icon for click events
			searchIcon.addEventListener('click', function (event) {
				console.log('clicked');
				event.preventDefault(); // Prevent default action (e.g., form submission)

				// Get the search query from the input field
				const query = searchInput.value;
				console.log(query);

				// Send a POST request to the server
				fetch('/search', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json'
					},
					body: JSON.stringify({ query: query })
				})
					.then(response => response.json())
					.then(data => {
						data.result.forEach(item => {
							console.log(item.name); // Accessing the 'name' property of each item
							console.log(item.description); // Accessing the 'description' property of each item
						});

						renderServices(data)
					})
					.catch(error => {
						console.error('Error sending search request:', error);
					});
			});
		});
		function renderServices(services) {
			const servicesContainer = document.getElementById('servicesContainer');
			servicesContainer.innerHTML = '';

			services.result.forEach((service) => {
				const name = document.createElement('div');
				name.innerHTML = 'Service name: ' + service.name;
				servicesContainer.appendChild(name);

				const des = document.createElement('div');
				des.innerHTML = service.description;
				servicesContainer.appendChild(des);
			});
		}
	</script>
	<%- include("templates/footer") %>

		<!-- 
finish the main page
	- create welcome container with search bar - with an appropriate colours that we chose from coolors
	- create container for the available robot services to be dynamically displayed in
	- create a file for template cards to be cloned from in the main page
	- create a placeholder for the AI assistance button, which we shayan and I will implement next week
 -->